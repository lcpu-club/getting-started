# 用好你的电脑 III：故障自查与知识串讲 {#heading}

## 硬件资源监控 {#hw-monitor}

有时候我们需要检查硬件的信息，包括处理器占用情况，内存占用情况，磁盘占用情况等等。

### 磁盘信息 {#disk-info}

如需查看磁盘占用情况，Windows和Linux下的文件管理器都能直观地提供以上信息，故此不再详述。

如需查看磁盘健康情况，可以使用``` smartctl ```命令(Linux)或者CrystalDiskInfo软件(Windows)查看。

### 处理器与内存信息 {#cpu-mem-info}

Windows下任务管理器即可，Linux下推荐``` btop ```程序。

### 电池信息 {#battery-info}

Windows下可以使用自带的``` powercfg ```命令生成html格式的电池信息报告，Linux下可以使用``` upower ```命令查看

## 常见故障自查 {#troubleshooting}

### 蓝屏 {#bsod}

蓝屏(BSOD, Blue Screen of Death)，通常意味着Windows内核发生了不可恢复的故障。常见的蓝屏原因包括系统服务异常（多是驱动导致），关键进程退出（可能是病毒引起），机器检查（硬件故障）等。如果最近新安装了硬件，可以考虑移除它们再试试，如果怀疑是驱动问题或者是病毒问题，可以考虑进入安全模式：

- 如果你还能进入系统：按下``` Win+R ```输入``` msconfig ```并回车，点击“引导”选项卡，勾选“安全启动”，点击应用，重启即可。

- 如果你不能进入系统：启动失败若干次后应该会出现恢复菜单，点击“疑难解答”-“高级选项”-“启动设置”，会提示重启进入安全模式。

安全模式下只有最基本的驱动和启动项会被加载，可以考虑卸载最近安装的驱动或者查杀病毒，如需查杀病毒，建议选择带网络的安全模式。

以前的系统也可通过启动时按F8进入安全模式菜单，但是目前这样做不太可行。

完成所有操作后，如果使用msconfig设置了安全模式，应当先取消勾选然后应用，然后重启回到正常模式看问题是否解决。

如果你想向驱动作者报告问题，可以使用WinDbg调试内核转储文件，在WinDbg中打开转储文件，使用``` !analyze -v ```获取完整分析报告。

### 内核恐慌 {#panic}

Linux内核的严重错误被叫做panic。其实由于Linux用户态和内核态耦合更低，且Linux本身容错能力更好，Linux panic遇见的频率相对更低，常见的原因也不外乎驱动故障，1号进程退出等。一般来说，部分硬件厂商为Linux提供的驱动问题较多，除了卸载驱动以外，还需要和驱动开发者和Linux内核维护者进行沟通，以取得更好的解决方案。

### 四国、五国、六国 {#darwinpanic}

MacOS的内核恐慌被叫做四国、五国或者六国，因为其会显示夺过语言版本的提示信息。笔者很久没用过MacOS设备，因此不便做出过多评价。

### 应用软件崩溃 {#application-crash}

这种情况比较复杂，有可能是软件本身的bug，也有可能是用户的环境或者使用软件的方式的问题。部分软件带有崩溃反馈模块，你可以用这个模块向开发者反馈信息。在反馈之前，请先确保你的软件是最新的，因为你发现的故障可能在新版本中已经被修复，同时需确保你正确使用软件。然后向开发者反馈故障时，尽可能给出软件版本、操作系统版本、库版本（如果有需要），硬件型号等信息，同时需给出较为详细的复现故障的步骤，必要时附上日志和截图（不要在正文中放大段日志，最好以附件或者在线剪贴板链接给出）。如果你使用Linux并且恰好开启了核心转储，你也可以调试转储文件（例如使用``` coredumpctl -r debug ```，然后输入``` bt ```），给出栈回溯信息等。

### 系统启动慢 {#system-slow}

Windows下打开任务管理器检查有无不必要启动项，加以禁止即可；Linux下可以使用``` journalctl ```检查日志，留意启动慢的服务，有针对性地加以解决（或者禁用服务）

### 应用程序慢 {#app-slow}

建议首先检查内存和处理器占用情况，结束其他无关程序；对于有网络IO的程序，检查网络连接；对于有磁盘IO的程序，检查磁盘健康状态。

### 网络连接故障 {#offline}

建议检查网线是否插好，网关是否登陆，是否欠费，DNS设置是否正确，上一次关机时代理是否正确关闭等等。对于Linux系统，可以检查``` rfkill ```是否允许相应网卡工作，``` ip ```是否启动相应适配器。

## 小知识串讲 {#knowledge-series}

### 快捷键 {#shortcut}

#### 系统快捷键 {#system-shortcut}

不同系统提供了不同的快捷键，这里简单介绍Windows和Linux在系统层面提供的快捷键。Windows徽标键（简称Win键）在Linux下也称Meta键，在Mac下则是Command键。F1-F12系列按键有可能需要同时按下Fn键使用。

- Windows

    ``` Ctrl+Alt+Del ```: 打开一个可以唤起任务管理器的屏幕。这个组合键比较特殊，它只能被内核捕获而不会传给用户态程序处理。

    ``` Ctrl+Shift+Esc ```: 直接打开任务管理器。

    ``` Alt+F4 ```: 关闭处于焦点的窗口。如果没有窗口处于焦点，打开关闭计算机的对话框。

    ``` Alt+Tab ```: 切换窗口。

    ``` Win+Tab ```: 切换桌面。

    ``` Win+R ```: 打开运行窗口。

    ``` PrintScreen(PrtSc) ```: 截图

- Linux

    Linux下很多快捷键由桌面环境提供，在此无法一一讲述，有兴趣的可以自行了解。一般这些快捷键可以根据个人使用习惯重新配置。

    ``` Ctrl+Alt+{F1-F12} ```: 切换tty。一般图形桌面位于tty1或者tty2。这一系列快捷键由Wayland或者Xorg提供

    ``` Alt+SysRq ```: 这是一系列快捷键，其中SysRq键就是PrintScreen键（有的键盘应该会在PrintScreen键下面一行写上SysRq），按下这个组合键后，再按下特定按键，内核会有不同的功能，如按下``` C ```会让内核强制崩溃；按下``` E ```会向所有进程发送SIGTERM使得它们可以做一些清理后退出；按下``` I ```会向所有进程发送SIGKILL使得它们强行退出；按下``` S ```会同步磁盘写入；按下``` U ```会使得所有文件系统被重新挂载为只读；按下``` B ```会让计算机立刻重启。注意：SysRq功能可以使用sysctl进行配置，默认可能并未开启全部功能。利用这些快捷键可以救回卡死的系统，或者可以在保证文件系统完整的情况下强行重启电脑。

- MacOS

    TODO!

#### Shell快捷键 {#shell-shortcut}

我们把这些快捷键单独放一栏。因为它们和操作系统关系较小。这些快捷键如无特殊说明主要针对Linux Shell。

``` Ctrl+C ```: 发送SIGINT到前台进程组，默认行为是程序退出。不能用于复制！

``` Ctrl+D ```: 关闭标准输入，或者说发送EOF（文件末尾）。在Windows Shell中，一般为``` Ctrl+Z, Enter ```。

``` Ctrl+Z ```: 发送SIGTSTP到前台进程组，默认行为是程序退出，可用``` fg ```使程序恢复运行，或使用``` bg ```使程序在后台恢复运行，或者直接向程序发送SIGCONT恢复运行。

``` Ctrl+\ ```: 发送SIGQUIT到前台进程组，和SIGINT不同的是，该信号默认不仅让程序退出，还会产生核心转储文件(coredump)。

``` Ctrl+Shift+C ```: 复制内容。

``` Ctrl+Shift+V ```: 粘贴内容。

``` Ctrl+A ```: 编辑命令时回到行首。

``` Ctrl+L ```: 清除屏幕，并重新打印当前行。

还有其他很多快捷键，有兴趣的同学可以网上搜索或者看bash的man手册。
