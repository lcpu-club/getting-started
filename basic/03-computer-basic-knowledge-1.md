# 计算机基本知识概览

::: info 本文信息
作者：000lbh

状态：未审阅的草稿版本
:::

## 软件与硬件

什么是软件？什么是硬件？相信刚接触计算机的同学也不会不清楚这个问题，我们在这里并不打算给软件和硬件一个正式的定义，而是通过举例介绍各种软件和硬件，从而使得同学们获得一个直观的认识。

### 硬件

各位刚刚接触计算机的同学可能还没有来得及拆开过你心爱的计算机。没关系，我们为大家提供了一些图片，同时通过这些图片进行介绍。

#### 计算

计算机，顾名思义，做计算的机器。  
长久以来，人们日常生活中，到处都需要计算，但不得不手工完成，耗费大量心智。  
于是，神降临了世界，从天间盗取了圣火。  
伟大的图灵，在众人面前伸手于虚无中画了个圈，曰，我有一圣物，这些问题都可以被我的机器求解!  
从此，自动化的机器极大地解放了人类。人类从此有了一个判定基准，先衡量一个问题是否属于图灵可计算，如果是，就可以从裤兜里掏出图灵机，盘之。  
开天辟地，计算机这门学科诞生。计算机，一个魔力的机器，一个让人又爱又狠的机器。无数后身工程师为之努力奋斗、脱发明志，为之痴迷，为之疯狂！  

![Turing](/assets/basic/03-computer-basic-knowledge-1/Turing.jpg)  
图1. Alan Turing (23 June 1912 – 7 June 1954), from wiki

#### 冯诺依曼架构

尽管有了原理，此时天地昏暗，依然看不见光明。  
冯诺依曼，跟着神的指引，构筑了世间万物。  
他具体提出的是这样一种实现形式，由运算器、控制器、存储器、输入输出设备组成。  
![Von Neumann Architecture](/assets/basic/03-computer-basic-knowledge-1/Von_Neumann_Architecture.svg)  

计算机就像一个数据计算加工的工厂，控制器有条不紊根据一条条指令控制处理器中的各个状态，指挥数据的搬运和计算，并与各类外设进行交互。  

而到了今天，现代计算机依然也基于这个架构进行设计。

![Von Neumann Machine](/assets/basic/03-computer-basic-knowledge-1/Von_Neumann_Machine.png)  

#### CPU

CPU是整个计算机的核心，承担着运算和控制的功能。CPU从存储设备中读取代码和数据，尽管现代处理器对代码和数据会有不同的处理，但是其本质上并没有严格的区分。代码由一条一条的指令组成，CPU按照顺序一条一条执行从存储设备中读取的指令（至少从软件和程序员等使用者的视角看是这样），指令可以是修改CPU的状态，进行运算，或者是从其他硬件读取信息或者输出信息。

![Intel 8086](/assets/basic/03-computer-basic-knowledge-1/Intel_C8086.jpg)

图2. 这是Intel 8086处理器，和现在的处理器“长相”很不一样，但是你案头的计算机用的处理器很可能与之兼容（除非你是新版Apple或者你自己知道你用的不是x86架构的处理器）。图源自wiki，获CC BY-SA授权

目前市面上的处理器拥有很多种不同的ISA(Instruction Set Architecture)，ISA定义了程序员如何使用CPU，如处理器有哪些指令、指令编码方式和功能、寄存器的大小数量和功能、怎么寻找和读取数据、能暂存多少数据、每个暂存的数据有多大、数据存放的顺序如何等等各种约定，并不是指令的简单集合。一般来说，为其他ISA编译好的程序是不能够直接在当前ISA上运行的，需要转译，或者（在有源代码的情况下）重新按照当前ISA进行编译。同学们在下载软件时，也要注意ISA的信息。下面是一些常见的ISA：

- x86: 最经典最常见的ISA，同学案头计算机的处理器基本都基于此，历史兼容性好（低情商：历史包袱重）
- ARM: 移动端（包括手机）常见的ISA，不管是苹果还是遥遥领先，处理器都使用该ISA。苹果M系列计算机也使用该处理器
- RiscV: 新兴的开源ISA，嵌入式设备中有使用，学校也喜欢用于教学
- Loongarch: 国产ISA
- 还有其他诸如MIPS、PowerPC等架构不再赘述

现代的ISA一般都设计保护功能。保护功能提供不同的模式，在特权模式下，代码有对处理器和硬件的（几乎）完全的控制权；而在非特权模式（用户模式）下，代码只能控制有限的资源，进行“安全”的操作，而其他操作需要通过切换到特权模式完成。同时，ISA提供了虚拟内存的功能，也就是将物理内存地址（也就是前文提到的“存储空间的编号”）映射到虚拟地址，并设置访问权限。

> 历史的注记：Intel当年受到HP的“蛊惑”联合开发了一个全新的64位架构IA64，处理器代号为安腾。该架构具有很多让人眼前一亮的特性，然而与之前Intel的x86完全不兼容。而AMD选择开发了与之前x86架构兼容的AMD64架构，迅速抢占市场份额。由于安腾落后的性能和开发速度，市场表现不佳，因此转而采用AMD64架构，或者更中立的名称，x86-64架构，而安腾逐渐被历史淘汰。

#### 内存

这里说的内存是RAM(Random Access Memory)，断电丢失数据的随机存储器。然而在不同语境下，内存也可以指下文中的“硬盘”，请注意区分。

内存是处理器CPU能够直接访问到的数据存储器。面向使用的程序员，内存被简化抽象为一个个存储单元，每个存储单元大小一个字节，或者说8比特，也就是8个数字0或者1，每个存储单元都有唯一编号，就像一个浩大的图书馆，在每个书架每个特定的位置存放着图书，并有编号。CPU就和我们找书的过程一样，通过编号，从内存拿出对应存储单元中的数据或者向存储单元写入数据。而随机存储器的“随机”意思是不论拿什么编号来找数据，所需时间总是差不太多的。

内存访问速度比其他外部存储要快，但是随着处理器的发展(由几MHz如8086的5MHz发展至几GHz)，内存速度的提升却跟不上处理器速度提升的步伐。今日从内存中找一个数据所需的典型时间内处理器大约能执行上百条指令，因此在离得更近的处理器内部引入了高速缓存。关于这一点，我们将在本章节第二部分讲述。

![DRAM](/assets/basic/03-computer-basic-knowledge-1/DRAM.jpg)
图1. 一根台式机内存条，来自尔必达(日本)，后为镁光公司收购。由于单颗内存芯片性能和性价比受限，故而将若干颗内存芯片并列组装成一个条形的内存模块。  

> 历史的注记：你知道吗？历史上Intel早期是一家内存制造公司。后因与日本的公司竞争不利，随转向处理器制造。
> 关于内存的发展历史，曾有不少滔天巨浪。此提供若干关键词供感兴趣的人进一步了解: Rambus之战, 奇梦达

#### 硬盘

有时候也被称作“内存”或者“外存”（是不是有些混乱？），不过你只需要记住我们这里讲的是断电数据不丢失的可以反复改写的存储设备即可。 

目前市面上主要有两种硬盘，一种是机械硬盘HDD，里面有一组极为平滑如镜子一样的硬质盘片，表面有磁性物质，旁边有若干磁头，背面则有电路和芯片进行控制。机械硬盘工作时，盘片高速运转，电路控制磁头悬浮在盘片表面(仅有几十微米甚至更小，小过你的头发丝！)通过磁场读写其中的内容。由于这种机械的旋转结构导致其对振动较为敏感(剧烈的撞击极易导致磁头撞击盘片表面从而损坏磁介质，产生坏道)，严忌于其工作时摔碰。 

另一种是固态硬盘SSD，里面没有高速运转的机械结构，取而代之的是闪存芯片和控制电路，在闪存芯片内部有大量的单元通过捕获电荷来存储信息。固态硬盘具有较为明确的寿命特点，其写入次数有限(个人日常使用的实际寿命并不一定比机械硬盘差,各有优缺)，且由于电荷流失，长时间不通电时不能保证数据稳定（以年为单位计算）。为了最大化固态硬盘寿命，其一般有较为复杂的控制电路，保证写入均匀地发生在固态硬盘的不同部位。

一般来说，固态硬盘较贵，速度较快，抗振动辐射，而机械硬盘较为廉价，但速率较低，不过相对固态硬盘数据存放稳定性较好。不过总之，重要数据应该做好备份，硬盘有价，数据无价。

![HDD](/assets/basic/03-computer-basic-knowledge-1/Laptop-hard-drive-exposed.jpg)
图3. 机械硬盘内部结构。图源自wiki，获CC BY-SA授权
![SDD](/assets/basic/03-computer-basic-knowledge-1/SSD.jpg)
图4. 固态硬盘内部结构。左SandForce标志芯片为主控，负责与主机通讯以及管理和读写右侧6颗闪存颗粒内的数据。图源自wiki，获CC BY-SA授权

> 提示：如果你在比较早的时候接触过或者从长辈口中听说过“磁盘碎片”这回事，请注意，固态硬盘不要整理磁盘碎片。

#### 其他你可能听说过或没有听说过的存储设备

- U盘: 较为简化的一种固态硬盘，通过USB接口与主机连接，性能较弱，主控结构比较简单  
- 存储卡: 也是一种固态硬盘，接口为移动插拔做了优化
- 光盘: 在闪存时代前常见的存储设备用于交换数据，一般只能写入一次，存储容量在几百M到几十G不等。内部有一层薄介质，通过激光在上面进行刻蚀，并通过反射读取信息  
- 软盘：更古董的设备，一个薄磁性塑料软片，故名软盘，存储容量在几个M左右  
- 磁带：一圈一圈卷起来的塑料磁性软带，因此读取写入只能顺序进行，意味着找数据的时间和当前读写位置的距离成正比（而不像随机存储器，基本无关），用于长时间保存巨量数据，需要特定的仪器和环境。

#### 存储层次结构

存储器有很多种类，速度、容量单价、稳定性都各有不同。根据其响应速度，存储器可被划分为多级结构：

![Memory Hierarchy](/assets/basic/03-computer-basic-knowledge-1/ComputerMemoryHierarchy.svg)
图5. 存储器层次结构示意图，公有领域作品

处理器中的寄存器，通常用于存储计算中的临时数据，随取随用性能要求极高，因此使用的晶体管非常多，同时其单位容量价格自然也是十分高。  

在寄存器和内存中间，一般还存在多级缓存。高速缓存由硬件自动管理，对一般程序员不可见。常用的数据将被放入速度快很多的缓存中。但由于其仍然占用了不少宝贵的芯片面积，故缓存单位容量的价格也比较高，目前个人计算机缓存的容量普遍在数十MB以内。  

内存参照前文，不再赘述。  

以上三种存储都属于易失性存储（volatile），也就是断电后数据将会在短时间内消失。而其中前两种存储是静态随机存储，意味着在通电状态下其状态可保持不需要进行刷新，但制造所需晶体管较多。而后者为了实现更大化地存储，通过电荷存储在一个个微小的电容中，故只需要一个晶体管，但其随着时间电荷会逐渐流失导致数据丢失，因此需要每几个毫秒对每个存储单元都进行刷新操作，故称为动态随机存储。

> 你可能会想问，缓存为什么能够在程序员不参与的情况下完成内存访问的提速，这就涉及到一个重要的概念：局部性原理。这个原理主要说的是，一个程序在总是倾向于访问最近访问过的存储单元或者与之相邻的存储单元，缓存可以据此将最近访问过的存储单元放入自身当中，或者预测将要访问的存储单元，将其提前放入自身当中。当然这种预测并不会百发百中，而基于缓存的工作原理，提升自己程序的局部性，是改善程序性能的一个好方法。

#### GPU

Graphic Process Unit, 也叫做显卡，最开始用于图形加速，后用于大量并行处理，如AI，科学计算等等。虽然GPU的计算能力远远大于CPU，但是各自特色分明: CPU擅长控制和逻辑，单核处理能力强的多，适合各种通用的场合; 而GPU仅适用于并行且逻辑简单的计算，以其独特的架构取胜。

#### 主板

将各种硬件连接在一起，形成一个电路系统，为主芯片的工作提供各类条件支持(如供电降压，数据的传输，机械支撑，芯片工作顺序的控制等)，提供固件进行硬件自我检查和系统初始化，保存各个硬件的配置等。

![Notebook Internal](/assets/basic/03-computer-basic-knowledge-1/Notebook_Internal.jpg)
图6. 一台笔记本电脑内部，上部蓝色主板上集合了若干各式功能的组件 (笔者自摄)

> 历史的注记：早年的计算机各个部件都是一个个独立的芯片，如8086是控制器和运算器，8087芯片实现浮点计算的功能，8089芯片则提供接口的功能，以及82系列的若干个功能芯片。后随着时代发展，这些功能被整合至一整个芯片上，称为SoC(System On Chip, 片上系统)。

#### 电源

为各类电子元件提供电力。CPU和GPU核心的工作电压通常很低，只有1V左右，比一节干电池的电压还来得低，但是工作电流很高，有几十至上百A。其他辅助芯片的电压通常也只需要5 V以内的直流供电。但是一般家庭供电是220 V, 50 Hz交流，因此需要此模块进行逐级降低，提供工作所需的大电流低电压。

#### 外设

外设种类众多，提供计算机对外的数据接口，如网络接口和WiFi天线可以使计算机连接到以太网，鼠标、键盘、显示器和声卡是人机交互的接口，而众人熟知的USB接口是各类外部设备与计算机进行交互的标准实现。设备种类众多，此处不一一赘述。

#### 计算机的发展历程

1945年（1946年2月14日对外公布），第一台计算机ENIAC诞生了。

### 软件

软件根据其功能不同也可以分为很多种，有一些软件是直接跟硬件打交道的，而另一些软件则直接跟用户打交道。前者包含操作系统和硬件驱动程序，而后者是我们平时使用的各类应用程序。另外，人们发现，各类软件有很多功能是相同的，于是人们开发了各种各样的“库”这个软件，为各个软件公用。  
操作系统为上层的各类用户软件提供了对各种资源，比如处理器、内存、网络、各种外部设备如打印机等的统一抽象和管理，使得大部分应用程序在大部分不同的硬件上都能正确、安全、高效地运行，简化了应用程序员的工作，同时也将不同资源进行隔离，尽可能防止有缺陷或者恶意的程序影响其他程序运行。  

这一节我们着重介绍Windows操作系统和Linux操作系统。

#### Windows

Windows是微软公司开发的图形化操作系统，具有成熟的图形界面。同学们个人计算机日常使用的系统很可能就是Windows（苹果用户除外）。Windows系统较为庞大，里面很多组件在日常使用中完全用不到，甚至是以一种历史包袱的形式存在。不过正因为如此，很多老旧的将近20年前的Windows软件仍然能在最新的系统中正常运行。

#### Linux

从1991年Linus宣告Linux的存在，到2024年，Linux已经走过30多个年头。下面是Linus向社区宣告Linux存在的邮件（尽管当时还没有名字）：
```
Hello everybody out there using minix -

I'm doing a (free) operating system (just a hobby, won't be big and
professional like gnu) for 386(486) AT clones. This has been brewing
since april, and is starting to get ready. I'd like any feedback on
things people like/dislike in minix, as my OS resembles it somewhat
(same physical layout of the file-system (due to practical reasons)
among other things).

I've currently ported bash(1.08) and gcc(1.40), and things seem to work.
This implies that I'll get something practical within a few months, and
I'd like to know what features most people would want. Any suggestions
are welcome, but I won't promise I'll implement them :-)

Linus (torv...@kruuna.helsinki.fi)

PS. Yes - it's free of any minix code, and it has a multi-threaded fs.
It is NOT protable (uses 386 task switching etc), and it probably never
will support anything other than AT-harddisks, as that's all I have :-(. 
```

严格来说，Linux只是一个“操作系统内核”，并没有包含用户态的程序，而一般来说，一个完整的操作系统需要包含用户态的一些基础设施，比如供更上层应用程序使用的库函数，以及用于管理其他软件和硬件，但不必放进内核态的程序。目前说Linux操作系统，一般指的是基于Linux内核衍生的各大发行版。大多发行版采用了来自GNU这个组织制作的各类辅助基础设置，故全名为GNU/Linux。各种Linux发行版为Linux内核配置了一系列用户态程序，这样才能构成一个完整的操作系统。

与Windows内核（名字是NT内核）不同，Linux内核并不直接提供图形界面，只提供了最基本的各个接口，Linux发行版的图形界面属于用户态程序，且是选配的。因此对于一个不需要图形界面的服务器，完全可以省下这一笔空间。与Windows不同，在Linux发行版中，Linux内核和系统的其他组建完全都是由一个个软件包组成的，如果你不需要某个功能，完全可以将相应的软件包移除。也可以用其他功能类似的软件包替换某个软件包。系统具有高度可定制性。

Linux是一种类Unix操作系统，API符合POSIX标准。

另外，更大的不同，Linux属于自由软件。和Linux内核一道组成发行版的程序绝大部分也是自由软件。自由软件的源代码不仅公开，还需要能够自由传播、修改、销售，只要你遵守许可证的条件。常见的许可证包括GPL，这个许可证要求基于GPL软件的衍生作品如果发布，则也必须按照GPL发布，而MIT，BSD，Apache许可证协议则较为松散，不要求衍生作品同样按照自身许可证发布，只需要恰当署名即可。介于这两种许可之间的许可有LGPL，MPL等。Windows版权则归微软所有，其源代码仅小范围知晓，即使旧版Windows源代码已经有所泄漏，由于无法取得授权，任何看到它的人也不能合法加以利用。

尽管Linus宣称Linux内核并不是一个portable的内核，显然，他是目前世界上最portable的内核。为什么会这样呢？这跟Linux是自由软件有很大关系。Linus相信，他向别人提供代码，别人也将代码分享给他，就是一种很好的模式。正因为有这种宽松自由的许可，使得Linux可以被任意改造去适配不同的硬件，而不需要Linus自己一个人或者几个人去完成这件事。

> 历史的注记：微软在21世纪初将Linux称作“癌症”，认为Linux侵犯了知识产权，试图在客户中培育对Linux的恐慌，并以专利威胁起诉Linux开发者。然而十年后，微软表示“We love Linux”，可能是因为Linux在服务器市场占有率已经很高了。

> 历史的注记：Windows有一个臭名昭著的“功能”————蓝屏死机。这是NT内核在遇到不可恢复的错误时产生的错误提示信息，由于蓝色色调本身较冷，以及早期Windows给人以不稳定的印象，这个界面因此变得声名狼藉。而对于Linux，这个情况被称为panic。Linux内核并不会出现蓝屏，一方面是Linux的错误分级相对良好，驱动常年迭代更新，在一些不重要的错误情况(注: 曾经有过某些Windows驱动开发者为了便于调试，在任何错误的条件下使用蓝屏的手段以导出状态进行调试。这一特性被继承到了实际用户手上)下允许内核“带病运行”（这不一定是好事），另一则是由于Linux无法直接提供图形界面，因此内核错误信息只显示在非图形界面的终端上，使用图形界面的用户只能看到大写锁定键的灯光一直闪烁，看不到任何提示信息。最近Linux内核开发者试图在内核严重错误时绘制一个黑色界面，并展示一个二维码作为错误提示信息。

#### 其他操作系统

- MacOS: 苹果专用，符合POSIX标准的Unix系统，老版本可在Intel机器安装（需要魔法），内核叫Darwin，修改自BSD系内核，部分开源
- FreeBSD: 符合POSIX标准的类Unix系统，和Linux只是内核不同，FreeBSD有完整的用户态程序，同时其采用更宽松的许可协议，而不是Linux的GPLv2。
- MSDOS: 古老的操作系统，无图形界面，已不使用，微软近期开源了几个版本的DOS。FreeDOS则是由其他志愿者实现的开源版本替代。

#### 移动操作系统

- Android: Google开发的基于Linux内核的操作系统，Google自己在上面开发了AOSP一套基础设施环境。
- iOS: 苹果公司的产品，2007年随iPhone横空问世，基于Darwin内核开发，封闭性较强。

## 计算机网络

我们这辈人生活在一个高度信息化的时代中，自打记事开始，很多人就知道网络，并且经常在网上进行查找资料，聊天视频，联机游戏等活动。那么计算机网络究竟是如何组织起来的呢？我们这篇文章将做一些简要的介绍

### OS/I七层模型

```
--------------
|   应用层    |     7
--------------
|   表示层    |     6
--------------
|   会话层    |     5
--------------
|   传输层    |     4
--------------
|   网络层    |     3
--------------
|  数据链路层  |     2
--------------
|   物理层    |     1
--------------
```

目前基本不再使用5、6层的说法，按照OS/I的定义和现在的实际情况，5、6层功能被4、7层包含。各层具体的作用我们以后再提。

### TCP/IP协议

TCP和IP协议分别工作在上述模型的第四层和第三层，IP协议为世界上每一个能连入全球互联网的设备分配一个地址，同时提供不可靠的包交换服务。数据包指的是一段长度有限（但不总是固定）的数据，不可靠的包交换意思是把数据包从出发地传送到目的地，但是不保证包按照顺序到达，不保证有且仅有一个包到达，不保证包内容正确。

IP协议目前有两个版本，一个是IPv4，其地址由点分十进制，也就是类似于111.111.111.111的形式表示，每个十进制范围是0-255，同时有许多地址被保留，如127.xxx.xxx.xxx，10.xxx.xxx.xxx，192.168.xxx.xxx，0.0.0.0，255.255.255.255等等，它们或被用于标示本机回环地址，或被用于局域网内，或被用于广播地址或保留地址。即使不考虑上述情况，IPv4也只能为最多4294967296（42亿）个设备分配唯一地址，很明显目前地球上的人口数已经远远超过这个数值，IPv4已经接近枯竭。目前的缓解办法包括NAT等协议使得多台设备共用一个公网IP，但是这样会存在很多不方便的地方。

> 练习：114.514.1919.810是不是有效的IPv4地址？

目前正在快速普及的IPv4的后继者是IPv6，其地址由冒号分隔的16进制组成，长度是128bit。如果地址中存在连续多项0，可以用两个冒号替代，但是只能替代一次。下面是一些IPv6的地址示例：

```
::1
240c:c001:1014:4a3a:22f7:cb5f:88e2:219d
fe80::b7bf:964:d695:708d
```
IPv6资源丰富很多，基本不会存在枯竭问题。

TCP是在IP之上的协议，利用IP协议提供的不可靠数据传输，为上层提供流式的端到端可靠数据传输。端口号是在这一层协议定义的。TCP协议存有状态，必须先双方三次交互建立连接，每个数据报文对方都要确认，报文都带有编号和校验码，确保报文正确按顺序到达。TCP不能保证服务质量，比如传输速率。

> 与TCP同层还有UDP协议。UDP协议不提供可靠传输服务，无状态，适合对数据准确性要求不高但是追求数据快速到达的场景，也适合上层实现别的可靠传输协议。

> 提示：指定端口号的地址，IPv4可以写作127.0.0.1:8080这种形式，IPv6可以写成[::1]:8080的形式。

### DNS协议

DNS(Domain Name System)协议是用于解析域名信息的协议。我们在日常上网的过程中，由于IP地址过于抽象难记，经常会使用类似于``` pku.edu.cn ```这样的域名，DNS就是将域名转化为IP地址的服务。DNS服务从点分隔的域名的最后一部分开始查找，整个查找过程先向系统预设的DNS服务器查找最后一部分``` cn ```，返回``` cn ```域名的服务器，然后向``` cn ```域名的服务器继续询问``` edu ```，直到整个域名解析完成，得到最终的IP地址。实际情况下，有时候DNS服务器会直接返回下一级域名服务器作为结果，也有时候会代替你继续查询，直接返回给你最终的结果。

> 提示：以前国内的网络运营商默认提供的DNS有时会遭到污染，进行植入广告等操作，这时候你可以自行更换DNS地址，你可以在互联网上查询到关于如何更换以及更换为哪些声誉较好的DNS服务的信息。
